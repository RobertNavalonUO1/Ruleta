<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/api/ruletaeuropea/Pantallas/PantallaLogin.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/api/ruletaeuropea/Pantallas/PantallaLogin.kt" />
              <option name="originalContent" value="package com.api.ruletaeuropea.pantallas&#10;&#10;import android.util.Log&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.text.KeyboardActions&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Lock&#10;import androidx.compose.material.icons.filled.Person&#10;&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.runtime.saveable.rememberSaveable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.res.painterResource&#10;import androidx.compose.ui.text.input.ImeAction&#10;&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.text.input.VisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;import com.api.ruletaeuropea.App&#10;import com.api.ruletaeuropea.R&#10;import com.api.ruletaeuropea.data.entity.Jugador&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;import kotlinx.coroutines.withContext&#10;import androidx.navigation.NavController&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.ElevatedCard&#10;import androidx.compose.material3.OutlinedButton&#10;import androidx.compose.foundation.BorderStroke&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.Modifier&#10;&#10;import androidx.compose.material.icons.filled.Visibility&#10;import androidx.compose.material.icons.filled.VisibilityOff&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.ui.platform.LocalConfiguration&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.foundation.layout.BoxWithConstraints&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.Dp&#10;&#10;@Composable&#10;fun PantallaLogin(&#10;    navController: NavController,&#10;    jugador: MutableState&lt;Jugador&gt;&#10;) {&#10;    val nombreState = rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    val contrasenaState = rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    val mensajeError = remember { mutableStateOf&lt;String?&gt;(null) }&#10;    val passwordVisible = rememberSaveable { mutableStateOf(false) }&#10;    val isLoading = remember { mutableStateOf(false) }&#10;    val scope = rememberCoroutineScope()&#10;    val dorado = Color(0xFFFFD700)&#10;    val fondo = painterResource(id = R.drawable.fondo)&#10;    val logo = painterResource(id = R.drawable.logoinico)&#10;&#10;    val cfg = LocalConfiguration.current&#10;    val widthDp = cfg.screenWidthDp&#10;    val heightDp = cfg.screenHeightDp&#10;    val isLandscape = widthDp &gt; heightDp&#10;    val sizeClass = when {&#10;        widthDp &gt;= 840 -&gt; &quot;expanded&quot;&#10;        widthDp &gt;= 600 -&gt; &quot;medium&quot;&#10;        else -&gt; &quot;compact&quot;&#10;    }&#10;    val isLowHeight = heightDp &lt; 520&#10;    // Aún más compacto: teléfonos muy pequeños o con teclado mostrando poco espacio útil&#10;    val isVeryCompactHeight = heightDp &lt; 460&#10;    val scrollState = rememberScrollState()&#10;&#10;    // Acción de login reutilizable (botón y tecla Done)&#10;    val onLogin: () -&gt; Unit = {&#10;        val nombre = nombreState.value.trim()&#10;        val contrasena = contrasenaState.value.trim()&#10;&#10;        if (nombre.isEmpty() || contrasena.isEmpty()) {&#10;            mensajeError.value = &quot;You must enter your username and password&quot;&#10;        } else {&#10;            scope.launch {&#10;                isLoading.value = true&#10;                try {&#10;                    val dao = App.database.jugadorDao()&#10;                    val existente = withContext(Dispatchers.IO) { dao.obtenerPorNombre(nombre) }&#10;&#10;                    if (existente == null) {&#10;                        val nuevo = Jugador(&#10;                            NombreJugador = nombre,&#10;                            Contrasena = contrasenaState.value.takeIf { it.isNotBlank() },&#10;                            NumMonedas = 1000,&#10;                            Nivel = 1,&#10;                            ExpActual = 0&#10;                        )&#10;                        withContext(Dispatchers.IO) { dao.insertar(nuevo) }&#10;                        jugador.value = nuevo&#10;                        navController.navigate(&quot;menu&quot;) {&#10;                            popUpTo(&quot;login&quot;) { inclusive = true }&#10;                        }&#10;                    } else {&#10;                        if (existente.Contrasena == contrasena) {&#10;                            jugador.value = existente&#10;                            navController.navigate(&quot;menu&quot;) {&#10;                                popUpTo(&quot;login&quot;) { inclusive = true }&#10;                            }&#10;                        } else {&#10;                            mensajeError.value = &quot;Incorrect password&quot;&#10;                        }&#10;                    }&#10;                } catch (e: Exception) {&#10;                    Log.e(&quot;PantallaLogin&quot;, &quot;Error en login&quot;, e)&#10;                    mensajeError.value = e.message ?: &quot;An unexpected error occurred. Please try again.&quot;&#10;                } finally {&#10;                    isLoading.value = false&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(Color.Black)&#10;    ) {&#10;        // Fondo base&#10;        Image(&#10;            painter = fondo,&#10;            contentDescription = &quot;Fondo decorativo&quot;,&#10;            contentScale = ContentScale.Crop,&#10;            modifier = Modifier.fillMaxSize()&#10;        )&#10;        // Overlay sutil para legibilidad&#10;        Box(&#10;            Modifier&#10;                .matchParentSize()&#10;                .background(&#10;                    Brush.verticalGradient(&#10;                        listOf(Color(0xCC000000), Color(0x99000000), Color(0x66000000))&#10;                    )&#10;                )&#10;        )&#10;&#10;        BoxWithConstraints(Modifier.fillMaxSize()) {&#10;            val cardMaxWidth = when (sizeClass) {&#10;                &quot;expanded&quot; -&gt; 600.dp&#10;                &quot;medium&quot; -&gt; 500.dp&#10;                else -&gt; 420.dp&#10;            }&#10;&#10;            val horizontalPadding = when (sizeClass) {&#10;                &quot;expanded&quot; -&gt; 48.dp&#10;                &quot;medium&quot; -&gt; 40.dp&#10;                else -&gt; if (isVeryCompactHeight) 16.dp else 24.dp&#10;            }&#10;            val verticalPadding = when {&#10;                isVeryCompactHeight -&gt; 6.dp&#10;                isLowHeight -&gt; 8.dp&#10;                else -&gt; 24.dp&#10;            }&#10;            val formSpacing = when {&#10;                isVeryCompactHeight -&gt; 8.dp&#10;                isLowHeight -&gt; 12.dp&#10;                else -&gt; 16.dp&#10;            }&#10;            val headlineStyle = when {&#10;                isVeryCompactHeight -&gt; MaterialTheme.typography.titleMedium&#10;                sizeClass == &quot;compact&quot; -&gt; MaterialTheme.typography.titleLarge&#10;                else -&gt; MaterialTheme.typography.headlineMedium&#10;            }&#10;&#10;            // Layout adaptativo&#10;            if (isLandscape &amp;&amp; sizeClass != &quot;compact&quot;) {&#10;                // Fila: logo + formulario&#10;                Row(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(horizontal = horizontalPadding, vertical = verticalPadding)&#10;                        // Evita que el teclado tape los campos en alturas pequeñas&#10;                        .imePadding()&#10;                        .navigationBarsPadding(),&#10;                    horizontalArrangement = Arrangement.spacedBy(32.dp),&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    // Logo escalado y centrado (ocúltalo si la altura es muy baja)&#10;                    if (!isVeryCompactHeight) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .weight(1f)&#10;                                .padding(end = 8.dp),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Image(&#10;                                painter = logo,&#10;                                contentDescription = &quot;Logo&quot;,&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .clip(CircleShape)&#10;                                    .padding(12.dp),&#10;                                contentScale = ContentScale.Fit&#10;                            )&#10;                        }&#10;                    }&#10;                    // Formulario en card&#10;                    LoginCard(&#10;                        nombreState = nombreState,&#10;                        contrasenaState = contrasenaState,&#10;                        mensajeError = mensajeError,&#10;                        passwordVisible = passwordVisible,&#10;                        isLoading = isLoading,&#10;                        onLogin = onLogin,&#10;                        navController = navController,&#10;                        jugador = jugador,&#10;                        dorado = dorado,&#10;                        isCompactHeight = isVeryCompactHeight || isLowHeight,&#10;                        modifier = Modifier&#10;                            .weight(1f)&#10;                            .widthIn(max = cardMaxWidth)&#10;                            .verticalScroll(scrollState),&#10;                        spacing = formSpacing,&#10;                        headlineStyle = headlineStyle&#10;                    )&#10;                }&#10;            } else {&#10;                // Columna apilada (portrait o pantalla compacta)&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(horizontal = horizontalPadding, vertical = verticalPadding)&#10;                        .verticalScroll(scrollState)&#10;                        // Da espacio a barras del sistema y teclado en pantallas pequeñas&#10;                        .imePadding()&#10;                        .navigationBarsPadding(),&#10;                    verticalArrangement = Arrangement.spacedBy(20.dp),&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    if (!isVeryCompactHeight) {&#10;                        Image(&#10;                            painter = logo,&#10;                            contentDescription = &quot;Logo&quot;,&#10;                            modifier = Modifier&#10;                                .widthIn(max = 220.dp)&#10;                                .fillMaxWidth(0.55f)&#10;                                .padding(top = if (isLowHeight) 8.dp else 24.dp),&#10;                            contentScale = ContentScale.Fit&#10;                        )&#10;                    }&#10;                    LoginCard(&#10;                        nombreState = nombreState,&#10;                        contrasenaState = contrasenaState,&#10;                        mensajeError = mensajeError,&#10;                        passwordVisible = passwordVisible,&#10;                        isLoading = isLoading,&#10;                        onLogin = onLogin,&#10;                        navController = navController,&#10;                        jugador = jugador,&#10;                        dorado = dorado,&#10;                        isCompactHeight = isVeryCompactHeight || isLowHeight,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .widthIn(max = cardMaxWidth),&#10;                        spacing = formSpacing,&#10;                        headlineStyle = headlineStyle&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Nuevo composable para la tarjeta de login reutilizable y responsive&#10;@Composable&#10;private fun LoginCard(&#10;    nombreState: MutableState&lt;String&gt;,&#10;    contrasenaState: MutableState&lt;String&gt;,&#10;    mensajeError: MutableState&lt;String?&gt;,&#10;    passwordVisible: MutableState&lt;Boolean&gt;,&#10;    isLoading: MutableState&lt;Boolean&gt;,&#10;    onLogin: () -&gt; Unit,&#10;    navController: NavController,&#10;    jugador: MutableState&lt;Jugador&gt;,&#10;    dorado: Color,&#10;    // Ajustes extra cuando la altura disponible es muy reducida&#10;    isCompactHeight: Boolean,&#10;    modifier: Modifier = Modifier,&#10;    spacing: Dp = 16.dp,&#10;    headlineStyle: androidx.compose.ui.text.TextStyle&#10;) {&#10;    ElevatedCard(&#10;        modifier = modifier,&#10;        shape = MaterialTheme.shapes.extraLarge,&#10;        colors = CardDefaults.elevatedCardColors(containerColor = Color(0xCC000000)),&#10;        elevation = CardDefaults.elevatedCardElevation(defaultElevation = 10.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .padding(horizontal = if (isCompactHeight) 16.dp else 24.dp, vertical = spacing),&#10;            verticalArrangement = Arrangement.spacedBy(spacing)&#10;        ) {&#10;            Text(&#10;                text = &quot;Log in or create your account&quot;,&#10;                color = dorado,&#10;                style = headlineStyle,&#10;                fontWeight = FontWeight.SemiBold,&#10;                maxLines = 2&#10;            )&#10;            OutlinedTextField(&#10;                value = nombreState.value,&#10;                onValueChange = {&#10;                    nombreState.value = it&#10;                    if (!mensajeError.value.isNullOrEmpty()) mensajeError.value = null&#10;                },&#10;                label = { Text(&quot;User name&quot;, color = dorado) },&#10;                placeholder = { Text(&quot;Enter your user name&quot;, color = dorado.copy(alpha = 0.7f)) },&#10;                singleLine = true,&#10;                leadingIcon = { Icon(imageVector = Icons.Filled.Person, contentDescription = null, tint = dorado) },&#10;                isError = mensajeError.value != null,&#10;                keyboardOptions = KeyboardOptions(imeAction = ImeAction.Next, keyboardType = KeyboardType.Text),&#10;                colors = OutlinedTextFieldDefaults.colors(&#10;                    focusedTextColor = dorado,&#10;                    unfocusedTextColor = dorado,&#10;                    focusedBorderColor = dorado,&#10;                    unfocusedBorderColor = dorado,&#10;                    cursorColor = dorado&#10;                )&#10;            )&#10;&#10;            OutlinedTextField(&#10;                value = contrasenaState.value,&#10;                onValueChange = {&#10;                    contrasenaState.value = it&#10;                    if (!mensajeError.value.isNullOrEmpty()) mensajeError.value = null&#10;                },&#10;                label = { Text(&quot;Password&quot;, color = dorado) },&#10;                placeholder = { Text(&quot;Enter your password&quot;, color = dorado.copy(alpha = 0.7f)) },&#10;                singleLine = true,&#10;                leadingIcon = { Icon(imageVector = Icons.Filled.Lock, contentDescription = null, tint = dorado) },&#10;                trailingIcon = {&#10;                    IconButton(onClick = { passwordVisible.value = !passwordVisible.value }) {&#10;                        val icon = if (passwordVisible.value) Icons.Filled.VisibilityOff else Icons.Filled.Visibility&#10;                        val desc = if (passwordVisible.value) &quot;Hide password&quot; else &quot;Show password&quot;&#10;                        Icon(imageVector = icon, contentDescription = desc, tint = dorado)&#10;                    }&#10;                },&#10;                visualTransformation = if (passwordVisible.value) VisualTransformation.None else PasswordVisualTransformation(),&#10;                isError = mensajeError.value != null,&#10;                supportingText = { mensajeError.value?.let { Text(it, color = MaterialTheme.colorScheme.error) } },&#10;                keyboardOptions = KeyboardOptions(imeAction = ImeAction.Done, keyboardType = KeyboardType.Password),&#10;                keyboardActions = KeyboardActions(onDone = { onLogin() }),&#10;                colors = OutlinedTextFieldDefaults.colors(&#10;                    focusedTextColor = dorado,&#10;                    unfocusedTextColor = dorado,&#10;                    focusedBorderColor = dorado,&#10;                    unfocusedBorderColor = dorado,&#10;                    cursorColor = dorado&#10;                )&#10;            )&#10;&#10;            Button(&#10;                onClick = onLogin,&#10;                enabled = !isLoading.value,&#10;                colors = ButtonDefaults.buttonColors(containerColor = dorado),&#10;                modifier = Modifier.height(if (isCompactHeight) 44.dp else 52.dp)&#10;            ) {&#10;                if (isLoading.value) {&#10;                    CircularProgressIndicator(&#10;                        color = Color.Black,&#10;                        strokeWidth = 2.dp,&#10;                        modifier = Modifier.size(20.dp)&#10;                    )&#10;                    Spacer(Modifier.width(10.dp))&#10;                    Text(&quot;Signing in...&quot;, color = Color.Black)&#10;                } else Text(&quot;Save and enter&quot;, color = Color.Black, fontWeight = FontWeight.Bold)&#10;            }&#10;&#10;            if (isCompactHeight) {&#10;                // En alturas compactas, apilar acciones para que no se recorten&#10;                Column(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    verticalArrangement = Arrangement.spacedBy(8.dp),&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    TextButton(onClick = { navController.navigate(&quot;register&quot;) }) { Text(&quot;Create account&quot;, color = dorado) }&#10;                    OutlinedButton(&#10;                        onClick = {&#10;                            jugador.value = Jugador(NombreJugador = &quot;Guest&quot;, NumMonedas = 1000, Nivel = 1, ExpActual = 0)&#10;                            navController.navigate(&quot;menu&quot;) {&#10;                                popUpTo(&quot;login&quot;) { inclusive = true }&#10;                            }&#10;                        },&#10;                        enabled = !isLoading.value,&#10;                        colors = ButtonDefaults.outlinedButtonColors(contentColor = dorado),&#10;                        border = BorderStroke(1.dp, dorado)&#10;                    ) { Text(&quot;Log as guest&quot;) }&#10;                }&#10;            } else {&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    TextButton(onClick = { navController.navigate(&quot;register&quot;) }) { Text(&quot;Create account&quot;, color = dorado) }&#10;                    OutlinedButton(&#10;                        onClick = {&#10;                            jugador.value = Jugador(NombreJugador = &quot;Guest&quot;, NumMonedas = 1000, Nivel = 1, ExpActual = 0)&#10;                            navController.navigate(&quot;menu&quot;) {&#10;                                popUpTo(&quot;login&quot;) { inclusive = true }&#10;                            }&#10;                        },&#10;                        enabled = !isLoading.value,&#10;                        colors = ButtonDefaults.outlinedButtonColors(contentColor = dorado),&#10;                        border = BorderStroke(1.dp, dorado)&#10;                    ) { Text(&quot;Log as guest&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.api.ruletaeuropea.pantallas&#10;&#10;import android.util.Log&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.text.KeyboardActions&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Lock&#10;import androidx.compose.material.icons.filled.Person&#10;&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.runtime.saveable.rememberSaveable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.res.painterResource&#10;import androidx.compose.ui.text.input.ImeAction&#10;&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.text.input.VisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;import com.api.ruletaeuropea.App&#10;import com.api.ruletaeuropea.R&#10;import com.api.ruletaeuropea.data.entity.Jugador&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;import kotlinx.coroutines.withContext&#10;import androidx.navigation.NavController&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.ElevatedCard&#10;import androidx.compose.material3.OutlinedButton&#10;import androidx.compose.foundation.BorderStroke&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.Modifier&#10;&#10;import androidx.compose.material.icons.filled.Visibility&#10;import androidx.compose.material.icons.filled.VisibilityOff&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.ui.platform.LocalConfiguration&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.Dp&#10;&#10;@Composable&#10;fun PantallaLogin(&#10;    navController: NavController,&#10;    jugador: MutableState&lt;Jugador&gt;&#10;) {&#10;    val nombreState = rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    val contrasenaState = rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    val mensajeError = remember { mutableStateOf&lt;String?&gt;(null) }&#10;    val passwordVisible = rememberSaveable { mutableStateOf(false) }&#10;    val isLoading = remember { mutableStateOf(false) }&#10;    val scope = rememberCoroutineScope()&#10;    val dorado = Color(0xFFFFD700)&#10;    val fondo = painterResource(id = R.drawable.fondo)&#10;    val logo = painterResource(id = R.drawable.logoinico)&#10;&#10;    val cfg = LocalConfiguration.current&#10;    val widthDp = cfg.screenWidthDp&#10;    val heightDp = cfg.screenHeightDp&#10;    val isLandscape = widthDp &gt; heightDp&#10;    val sizeClass = when {&#10;        widthDp &gt;= 840 -&gt; &quot;expanded&quot;&#10;        widthDp &gt;= 600 -&gt; &quot;medium&quot;&#10;        else -&gt; &quot;compact&quot;&#10;    }&#10;    val isLowHeight = heightDp &lt; 520&#10;    // Aún más compacto: teléfonos muy pequeños o con teclado mostrando poco espacio útil&#10;    val isVeryCompactHeight = heightDp &lt; 460&#10;    val scrollState = rememberScrollState()&#10;&#10;    // Acción de login reutilizable (botón y tecla Done)&#10;    val onLogin: () -&gt; Unit = {&#10;        val nombre = nombreState.value.trim()&#10;        val contrasena = contrasenaState.value.trim()&#10;&#10;        if (nombre.isEmpty() || contrasena.isEmpty()) {&#10;            mensajeError.value = &quot;Debes introducir usuario y contraseña&quot;&#10;        } else {&#10;            scope.launch {&#10;                isLoading.value = true&#10;                try {&#10;                    val dao = App.database.jugadorDao()&#10;                    val existente = withContext(Dispatchers.IO) { dao.obtenerPorNombre(nombre) }&#10;&#10;                    if (existente == null) {&#10;                        val nuevo = Jugador(&#10;                            NombreJugador = nombre,&#10;                            Contrasena = contrasenaState.value.takeIf { it.isNotBlank() },&#10;                            NumMonedas = 1000,&#10;                            Nivel = 1,&#10;                            ExpActual = 0&#10;                        )&#10;                        withContext(Dispatchers.IO) { dao.insertar(nuevo) }&#10;                        jugador.value = nuevo&#10;                        navController.navigate(&quot;menu&quot;) {&#10;                            popUpTo(&quot;login&quot;) { inclusive = true }&#10;                        }&#10;                    } else {&#10;                        if (existente.Contrasena == contrasena) {&#10;                            jugador.value = existente&#10;                            navController.navigate(&quot;menu&quot;) {&#10;                                popUpTo(&quot;login&quot;) { inclusive = true }&#10;                            }&#10;                        } else {&#10;                            mensajeError.value = &quot;Contraseña incorrecta&quot;&#10;                        }&#10;                    }&#10;                } catch (e: Exception) {&#10;                    Log.e(&quot;PantallaLogin&quot;, &quot;Error en login&quot;, e)&#10;                    mensajeError.value = e.message ?: &quot;Ha ocurrido un error inesperado. Inténtalo de nuevo.&quot;&#10;                } finally {&#10;                    isLoading.value = false&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(Color.Black)&#10;    ) {&#10;        // Fondo base&#10;        Image(&#10;            painter = fondo,&#10;            contentDescription = &quot;Fondo decorativo&quot;,&#10;            contentScale = ContentScale.Crop,&#10;            modifier = Modifier.fillMaxSize()&#10;        )&#10;        // Overlay sutil para legibilidad&#10;        Box(&#10;            Modifier&#10;                .matchParentSize()&#10;                .background(&#10;                    Brush.verticalGradient(&#10;                        listOf(Color(0xCC000000), Color(0x99000000), Color(0x66000000))&#10;                    )&#10;                )&#10;        )&#10;&#10;        Box(&#10;            Modifier.fillMaxSize()&#10;        ) {&#10;            val cardMaxWidth = when (sizeClass) {&#10;                &quot;expanded&quot; -&gt; 600.dp&#10;                &quot;medium&quot; -&gt; 500.dp&#10;                else -&gt; 420.dp&#10;            }&#10;&#10;            val horizontalPadding = when (sizeClass) {&#10;                &quot;expanded&quot; -&gt; 48.dp&#10;                &quot;medium&quot; -&gt; 40.dp&#10;                else -&gt; if (isVeryCompactHeight) 16.dp else 24.dp&#10;            }&#10;            val verticalPadding = when {&#10;                isVeryCompactHeight -&gt; 6.dp&#10;                isLowHeight -&gt; 8.dp&#10;                else -&gt; 24.dp&#10;            }&#10;            val formSpacing = when {&#10;                isVeryCompactHeight -&gt; 8.dp&#10;                isLowHeight -&gt; 12.dp&#10;                else -&gt; 16.dp&#10;            }&#10;            val headlineStyle = when {&#10;                isVeryCompactHeight -&gt; MaterialTheme.typography.titleMedium&#10;                sizeClass == &quot;compact&quot; -&gt; MaterialTheme.typography.titleLarge&#10;                else -&gt; MaterialTheme.typography.headlineMedium&#10;            }&#10;&#10;            // Layout adaptativo&#10;            if (isLandscape &amp;&amp; sizeClass != &quot;compact&quot;) {&#10;                Row(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(horizontal = horizontalPadding, vertical = verticalPadding)&#10;                        .imePadding()&#10;                        .navigationBarsPadding(),&#10;                    horizontalArrangement = Arrangement.spacedBy(32.dp),&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    // Columna izquierda: formulario completo (ancho fijo dentro del peso)&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .weight(1f)&#10;                            .fillMaxHeight(),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        LoginCard(&#10;                            nombreState = nombreState,&#10;                            contrasenaState = contrasenaState,&#10;                            mensajeError = mensajeError,&#10;                            passwordVisible = passwordVisible,&#10;                            isLoading = isLoading,&#10;                            onLogin = onLogin,&#10;                            navController = navController,&#10;                            jugador = jugador,&#10;                            dorado = dorado,&#10;                            isCompactHeight = isVeryCompactHeight || isLowHeight,&#10;                            modifier = Modifier&#10;                                .widthIn(max = cardMaxWidth)&#10;                                .verticalScroll(scrollState),&#10;                            spacing = formSpacing,&#10;                            headlineStyle = headlineStyle&#10;                        )&#10;                    }&#10;                    // Columna derecha: logo siempre visible en landscape&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .weight(1f)&#10;                            .fillMaxHeight(),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Image(&#10;                            painter = logo,&#10;                            contentDescription = &quot;Logo de la aplicación&quot;,&#10;                            modifier = Modifier&#10;                                .fillMaxWidth(0.9f)&#10;                                .aspectRatio(1f) // cuadrado aproximado&#10;                                .padding(12.dp),&#10;                            contentScale = ContentScale.Fit&#10;                        )&#10;                    }&#10;                }&#10;            } else {&#10;                // Columna apilada (portrait o pantalla compacta)&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(horizontal = horizontalPadding, vertical = verticalPadding)&#10;                        .verticalScroll(scrollState)&#10;                        // Da espacio a barras del sistema y teclado en pantallas pequeñas&#10;                        .imePadding()&#10;                        .navigationBarsPadding(),&#10;                    verticalArrangement = Arrangement.spacedBy(20.dp),&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    if (!isVeryCompactHeight) {&#10;                        Image(&#10;                            painter = logo,&#10;                            contentDescription = &quot;Logo&quot;,&#10;                            modifier = Modifier&#10;                                .widthIn(max = 220.dp)&#10;                                .fillMaxWidth(0.55f)&#10;                                .padding(top = if (isLowHeight) 8.dp else 24.dp),&#10;                            contentScale = ContentScale.Fit&#10;                        )&#10;                    }&#10;                    LoginCard(&#10;                        nombreState = nombreState,&#10;                        contrasenaState = contrasenaState,&#10;                        mensajeError = mensajeError,&#10;                        passwordVisible = passwordVisible,&#10;                        isLoading = isLoading,&#10;                        onLogin = onLogin,&#10;                        navController = navController,&#10;                        jugador = jugador,&#10;                        dorado = dorado,&#10;                        isCompactHeight = isVeryCompactHeight || isLowHeight,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .widthIn(max = cardMaxWidth),&#10;                        spacing = formSpacing,&#10;                        headlineStyle = headlineStyle&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Nuevo composable para la tarjeta de login reutilizable y responsive&#10;@Composable&#10;private fun LoginCard(&#10;    nombreState: MutableState&lt;String&gt;,&#10;    contrasenaState: MutableState&lt;String&gt;,&#10;    mensajeError: MutableState&lt;String?&gt;,&#10;    passwordVisible: MutableState&lt;Boolean&gt;,&#10;    isLoading: MutableState&lt;Boolean&gt;,&#10;    onLogin: () -&gt; Unit,&#10;    navController: NavController,&#10;    jugador: MutableState&lt;Jugador&gt;,&#10;    dorado: Color,&#10;    isCompactHeight: Boolean,&#10;    modifier: Modifier = Modifier,&#10;    spacing: Dp = 16.dp,&#10;    headlineStyle: androidx.compose.ui.text.TextStyle&#10;) {&#10;    ElevatedCard(&#10;        modifier = modifier,&#10;        shape = MaterialTheme.shapes.extraLarge,&#10;        colors = CardDefaults.elevatedCardColors(containerColor = Color(0xCC000000)),&#10;        elevation = CardDefaults.elevatedCardElevation(defaultElevation = 10.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .padding(horizontal = if (isCompactHeight) 16.dp else 24.dp, vertical = spacing),&#10;            verticalArrangement = Arrangement.spacedBy(spacing)&#10;        ) {&#10;            Text(&#10;                text = &quot;Inicia sesión o crea tu cuenta&quot;,&#10;                color = dorado,&#10;                style = headlineStyle,&#10;                fontWeight = FontWeight.SemiBold,&#10;                maxLines = 2&#10;            )&#10;            OutlinedTextField(&#10;                value = nombreState.value,&#10;                onValueChange = {&#10;                    nombreState.value = it&#10;                    if (!mensajeError.value.isNullOrEmpty()) mensajeError.value = null&#10;                },&#10;                label = { Text(&quot;Nombre de usuario&quot;, color = dorado) },&#10;                placeholder = { Text(&quot;Introduce tu nombre de usuario&quot;, color = dorado.copy(alpha = 0.7f)) },&#10;                singleLine = true,&#10;                leadingIcon = { Icon(imageVector = Icons.Filled.Person, contentDescription = null, tint = dorado) },&#10;                isError = mensajeError.value != null,&#10;                keyboardOptions = KeyboardOptions(imeAction = ImeAction.Next, keyboardType = KeyboardType.Text),&#10;                colors = OutlinedTextFieldDefaults.colors(&#10;                    focusedTextColor = dorado,&#10;                    unfocusedTextColor = dorado,&#10;                    focusedBorderColor = dorado,&#10;                    unfocusedBorderColor = dorado,&#10;                    cursorColor = dorado&#10;                )&#10;            )&#10;&#10;            OutlinedTextField(&#10;                value = contrasenaState.value,&#10;                onValueChange = {&#10;                    contrasenaState.value = it&#10;                    if (!mensajeError.value.isNullOrEmpty()) mensajeError.value = null&#10;                },&#10;                label = { Text(&quot;Contraseña&quot;, color = dorado) },&#10;                placeholder = { Text(&quot;Introduce tu contraseña&quot;, color = dorado.copy(alpha = 0.7f)) },&#10;                singleLine = true,&#10;                leadingIcon = { Icon(imageVector = Icons.Filled.Lock, contentDescription = null, tint = dorado) },&#10;                trailingIcon = {&#10;                    IconButton(onClick = { passwordVisible.value = !passwordVisible.value }) {&#10;                        val icon = if (passwordVisible.value) Icons.Filled.VisibilityOff else Icons.Filled.Visibility&#10;                        val desc = if (passwordVisible.value) &quot;Ocultar contraseña&quot; else &quot;Mostrar contraseña&quot;&#10;                        Icon(imageVector = icon, contentDescription = desc, tint = dorado)&#10;                    }&#10;                },&#10;                visualTransformation = if (passwordVisible.value) VisualTransformation.None else PasswordVisualTransformation(),&#10;                isError = mensajeError.value != null,&#10;                supportingText = { mensajeError.value?.let { Text(it, color = MaterialTheme.colorScheme.error) } },&#10;                keyboardOptions = KeyboardOptions(imeAction = ImeAction.Done, keyboardType = KeyboardType.Password),&#10;                keyboardActions = KeyboardActions(onDone = { onLogin() }),&#10;                colors = OutlinedTextFieldDefaults.colors(&#10;                    focusedTextColor = dorado,&#10;                    unfocusedTextColor = dorado,&#10;                    focusedBorderColor = dorado,&#10;                    unfocusedBorderColor = dorado,&#10;                    cursorColor = dorado&#10;                )&#10;            )&#10;&#10;            Button(&#10;                onClick = onLogin,&#10;                enabled = !isLoading.value,&#10;                colors = ButtonDefaults.buttonColors(containerColor = dorado),&#10;                modifier = Modifier.height(if (isCompactHeight) 44.dp else 52.dp)&#10;            ) {&#10;                if (isLoading.value) {&#10;                    CircularProgressIndicator(&#10;                        color = Color.Black,&#10;                        strokeWidth = 2.dp,&#10;                        modifier = Modifier.size(20.dp)&#10;                    )&#10;                    Spacer(Modifier.width(10.dp))&#10;                    Text(&quot;Entrando...&quot;, color = Color.Black)&#10;                } else Text(&quot;Entrar&quot;, color = Color.Black, fontWeight = FontWeight.Bold)&#10;            }&#10;&#10;            // Botones secundarios apilados siempre&#10;            Column(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                verticalArrangement = Arrangement.spacedBy(8.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                TextButton(onClick = { navController.navigate(&quot;register&quot;) }) { Text(&quot;Crear cuenta&quot;, color = dorado) }&#10;                OutlinedButton(&#10;                    onClick = {&#10;                        jugador.value = Jugador(NombreJugador = &quot;Invitado&quot;, NumMonedas = 1000, Nivel = 1, ExpActual = 0)&#10;                        navController.navigate(&quot;menu&quot;) {&#10;                            popUpTo(&quot;login&quot;) { inclusive = true }&#10;                        }&#10;                    },&#10;                    enabled = !isLoading.value,&#10;                    colors = ButtonDefaults.outlinedButtonColors(contentColor = dorado),&#10;                    border = BorderStroke(1.dp, dorado)&#10;                ) { Text(&quot;Entrar como invitado&quot;) }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Preview para Android Studio&#10;@androidx.compose.ui.tooling.preview.Preview(&#10;    name = &quot;Pantalla Login&quot;,&#10;    showBackground = true,&#10;    showSystemUi = true&#10;)&#10;@Composable&#10;private fun PantallaLoginPreview() {&#10;    // NavController de prueba&#10;    val navController = androidx.navigation.compose.rememberNavController()&#10;    // Estado de jugador simulado&#10;    val jugadorState = remember { mutableStateOf(&#10;        Jugador(&#10;            NombreJugador = &quot;&quot;,&#10;            NumMonedas = 1000,&#10;            Nivel = 1,&#10;            ExpActual = 0&#10;        )&#10;    ) }&#10;    // En caso de tener un Theme propio se puede envolver aquí. Ejemplo:&#10;    // AppTheme { PantallaLogin(navController, jugadorState) }&#10;    PantallaLogin(navController = navController, jugador = jugadorState)&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>